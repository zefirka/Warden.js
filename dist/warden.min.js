!function(t,n){if("object"==typeof exports&&exports)module.exports=n();else{var e=n();"function"==typeof define&&define.amd?define(e):t.Warden=e}}(this,function(){"use strict";var Warden=function(t,n){return Warden.extend(is.exist(t)?t:{},n)},jQueryInited="undefined"!=typeof jQuery;return Warden.version="0.4.3",Warden.configure={history:3,cmp:function(t,n){return t===n}},function(){function each(t,n){for(var e=0,r=t.length;r>e;e++)n(t[e],e)}function forWhile(t,n,e,r){e=e||!1;for(var i=0,s=t.length;s>i;i++)if(n(t[i],i)===e)return e;return void 0!==r?r:!0}function filter(t,n){var e=[];return each(t,function(t,r){n(t,r)===!0&&e.push(t)}),e}function reduce(t,n){for(var e=t[0],r=1,i=t.length;i>r;r++)e=n(e,t[r]);return e}function map(t,n){var e=[];return each(t,function(t,r){e[r]=n(t,r)}),e}function some(t,n){return forWhile(t,n,!0,!1)}function every(t,n){return forWhile(t,n)}function truthy(t){return t?!0:!1}function typeIs(t){return function(n){return typeof n===t}}function trim(t){return t.replace(/^\s+|\s+$/g,"")}function not(t){return function(n){return!t(n)}}function toArray(t){return is.obj(t)&&!is.exist(t.length)&&(t.length=Object.keys(t).length),Array.prototype.slice.call(t)}function extend(){function t(t,n){if(!n||typeof n!==_OBJ)return t;for(var e=Object.keys(n),r=e.length;r--;)t[e[r]]=n[e[r]];return t}return reduce(toArray(arguments),function(n,e){return t(n,e)})}function Pipeline(t,n){function e(t,n){return n?s=0:s==r.length?(s=0,u.fin(t)):(s++,void r[s-1].apply(u.ctx,[t,a]))}var r=t||[],i=0,s=0,a={next:function(t){return e(t)},stop:function(){return s=0},pause:function(){return i=1},play:function(){return i=0},host:function(){return n}},u={pipe:function(t){return t?(r.push(t),u):r},start:function(t,n,a){return u.ctx=n,u.fin=a,s=i?0:s,s==r.length?(s=0,a(t)):void e(t)}};return u}var Utils,_FUN="function",_NUM="number",_STR="string",_OBJ="object",_ARR="array",_BOOL="boolean",_UND="undefined",is={exist:function(t){return typeof t!=_UND&&null!==t},array:function(t){return Array.isArray(t)},fn:typeIs(_FUN),num:typeIs(_NUM),str:typeIs(_STR),bool:typeIs(_BOOL),equals:function(t){return function(n){return t===n}}};is.obj=function(t){return typeIs(_OBJ)(t)&&!is.array(t)};var hashc=function(){var t={};return{get:function(n){return t[n]},set:function(n){return t[n]=((parseInt(t[n],16)||0)+1).toString(16)},clean:function(n){delete t[n]}}}();Utils={is:is,not:not,forWhile:forWhile,each:each,filter:filter,some:some,every:every,map:map,reduce:reduce,toArray:toArray,interpolate:function(t){var n={},e=arguments.length,r=Utils.toArray(arguments),i=/{{\s*[\w\.\/\[\]]+\s*}}/g;return 2==e&&is.obj(r[1])?n=r[1]:each(r.slice(1,e),function(t,e){n[e]=t}),t.replace(i,function(t){var e=Utils.getObject(n,t.slice(2,-2)),r=is.exist(e)?e:t;return is.obj(r)&&(r=JSON.stringify(r)),r})},extend:extend,trim:trim,getObject:function(t,n){return is.obj(t)?(each(n.split("/"),function(n){if(!is.exist(t))return t;var e;if("["==n[0]&&"]"==n[n.length-1]){if(e=n.slice(1,-1),is.exist(e)){if(!is.num(parseInt(e)))throw"Wrong syntax";n=parseInt(e)}}else is.exist(t[n])||(t={});t=t[n]}),t):t},Queue:function(t,n){var e=n||[],t=t||16,r=e.push;return e.last=function(){return e[e.length-1]},e.push=function(n){return this.length>=t&&this.shift(),r.apply(e,[n])},e},$hash:hashc},Warden.Utils=Utils,Warden.extend=function(){function t(t){return/.?[\*\[\]\{\}\.\?\$\^\\\|].?/g.test(t)}function n(t){each(t,function(t,n){this[n]=t}.bind(this))}function e(t,n,e){Object.defineProperty(t,n,{configurable:!1,enumerable:!1,writable:!1,value:e})}var r="addEventListener",i="attachEvent",s={arrays:["pop","push","splice","reverse","shift","unshift","sort"],names:{emit:"emit",listen:"listen",stream:"stream",unlisten:"unlisten"},emitter:null,listener:null},a={},u=function(t){a[t]=a[t]||[],each(toArray(arguments).slice(1),function(n){a[t].push(n)})},o=function(t){return a[t]||[]};return function(a,c){function f(t,n,e){return function(r){var i=this;if(every(n,function(t){return is.str(r)?t.type==r:t.type.test(r)})&&i[h.listener]){if(!is.str(r))throw new Error("Invalid format in: "+h.listener);this[h.listener].apply(this,[r,function(n){t.call(i,n)}])}u(i.$$id,{type:r,callback:e})}}function l(t,n,e){t[n]=e}var h=extend({},s,c||{}),p=is.exist(a)?a:{},d=!0,m=h.names;if(is.fn(a))p=a.prototype;else{if(typeof a!==_OBJ){var v=Warden.Stream().watch();return v.fire(a),v}d=!1,is.array(a)&&(n.prototype=Object.create(p),e(n.prototype,"repeatedly",function(){var t=this,n=t.length;return Warden.Stream(function(e){var r=0;setTimeout(function(){for(;n>r;)e(t[r++])})})}),e(n.prototype,"sequentially",function(t){var n=this,e=n.length;return Warden.Stream(function(r){var i=0,s=setInterval(function(){e>i?(r(n[i]),i++):(i=0,clearInterval(s))},t)})}),each(h.arrays,function(t){e(n.prototype,t,function(){var n=this;Array.prototype[t].apply(this,arguments),this.emit({type:t,prev:n,current:this,data:toArray(arguments)})})}),a=new n(a),p=n.prototype,l=function(t,n,r){return e(t,n,r)})}var g=p[m.emit]||p[m.listen]||p[m.unlisten]||p[m.stream];if(is.exist(g))throw new Error("Can't overwrite: "+(g.name?g.name:g)+" of object");return jQueryInited&&(d?!0:a instanceof jQuery)?(h.emitter=h.emitter||"trigger",h.listener=h.listener||"on"):(is.fn(p[r])||is.fn(p[i]))&&(h.listener=h.listener||(is.fn(p[r])?r:i)),l(p,m.emit,function(t,n){var e=this,r=is.str(t)?t:t.type,n=is.obj(t)?t:n||t,i=filter(o(this.$$id=this.$$id||hashc.set("o")),function(t){return is.str(t.type)?t.type==r:t.type.test(r)});return each(i,function(t){t.callback.call(e,n)}),this}),l(p,m.listen,function(n,e){var r=this,i=f(function(t){this.emit(t)},o(this.$$id=this.$$id||hashc.set("o")),e);return each(n.split(","),function(n){n=trim(n),i.call(r,t(n)?new RegExp(n):n)}),this}),l(p,m.unlisten,function(t,n){var e=[],t=trim(t),r=o(this.$$id=this.$$id||hashc.set("o"));return r.length&&(n?each(r,function(r,i){r.callback.name==(n.name||n)&&r.type.toString()==t.toString()&&e.push(i)}):e=new Array(r.length),each(e,function(t){r.splice(t,1)})),this}),l(p,m.stream,function(n,e){var r=this,i=Warden.Stream(null,e||this),s=function(t){i.fire(t,e||this)},a=f(s,o(this.$$id=this.$$id||hashc.set("o")),s);return each(n.split(","),function(n){n=trim(n),a.call(r,t(n)?new RegExp(n):n)}),i}),a}}(),Warden.Pipeline=Pipeline;var Stream=function(){function inheritFrom(t,n){return t.parent=n,n.children.push(t),t}function process(t){var n=pipes[this.$$id],e=n.pipe().slice();return e.push(t),inheritFrom(new Stream(e),this)}function Stream(t,n){var e=Warden.configure.history;this.$$id=Utils.$hash.set("d"),this.$$context=n||{},this.$$obs=!1,this.parent=null,this.children=[],handlers[this.$$id]=[],pipes[this.$$id]=Pipeline(t||[],this),this.data={fires:new Utils.Queue(e),takes:new Utils.Queue(e),last:null}}var handlers={},pipes={};return Stream.prototype={valueOf:function(t){return this.data.last},toString:function(t){return this.data.last.toString()},bindTo:function(){var t=Warden.Watcher.apply(null,[this].concat(toArray(arguments)));return t},exec:function(t,n){if(this.$$obs){var e=this.$$id,r=this;this.data.fires.push(t),pipes[e].start(t,n,function(t){r.data.takes.push(t),r.data.last=t,each(handlers[e],function(e){e.call(n,t)})})}},fire:function(t,n){if(!this.locked){if(n=n||this.$$context,!this.$$obs)return void each(this.children,function(e){e.fire(t,n)});this.exec(t,n),each(this.children,function(e){e.fire(t,n)})}},listen:function(t){return this.$$obs=!0,handlers[this.$$id].push(t),this},watch:function(){return this.$$obs=!0,this},mute:function(t){var n=this;return Utils.forWhile(handlers[this.$$id],function(e,r){return(is.fn(t)?e==t:e.name==t)?(handlers[n.$$id].splice(r,1),!1):void 0},!1),this},clear:function(){handlers[this.$$id]=[]},log:function(t){return this.listen(function(n){console.log(t?t.replace(/\$/g,n):n)})},filter:function(t){return is.fn(t)?process.call(this,function(n,e){return t.call(this,n)===!0?e.next(n):e.stop()}):process.call(this,function(n,e){return Warden.configure.cmp(t,n)===!0?e.next(n):e.stop()})},map:function(t){return process.call(this,function(n,e){is.fn(t)?e.next(t.call(this,n)):e.next(t)})},grep:function(mapper){function grep(str,event){"."==str[0]&&(str="$"+str);var expression=str.replace(/\$/g,"event").replace(/^@$/g,"this").replace(/^@/g,"this.").replace(/@/g,"this");return str.match(/[\$\@\.]/g)?eval(expression):expression}function functor(t){return is.str(t)?is.fn(t)?function(n){return t.call(ctx,n)}:function(n){return grep.call(this,t,n)}:function(){return t}}function decide(t){var n=null;if(is.array(t))n=map(t,function(t){return decide(t)});else if(is.obj(t)){n={};for(var e in t)n[e]=decide(t[e])}else n=functor(t);return n}function apply(t,n,e){if(is.array(n))return n.map(function(n){return apply(t,n,e)});if(is.obj(n)){var r={};for(var i in n)r[i]=apply(t,n[i],e);return r}return n.call(e,t)}var getter=decide(mapper);return process.call(this,function(t,n){n.next(apply.call(this,t,getter,this))})},reduce:function(t,n){var e=new Utils.Queue(1);return process.call(this,function(r,i){var s;i.host();return s=0==e.length?n?n.call(this,t,r):r:(n||t).call(this,e[e.length-1],r),e.push(s),i.next(s)})},take:function(t){return process.call(this,function(n,e){var r=e.host();return r.data.limit=r.data.limit||t,r.data.taken=r.data.taken+1||0,r.data.taken>=r.data.limit?e.stop():e.next(n)})},skip:function(t){var n=this;return process.call(this,function(e,r){n.skips=n.skips||0,n.skips==t?(delete n.skips,r.next(e)):(n.skips+=1,r.stop())})},interpolate:function(t){return process.call(this,function(n,e){return e.next(Utils.interpolate(t,n))})},mask:function(t){return process.call(this,function(n,e){return e.next(is.str(n)?Utils.interpolate(n,t):n)})},diff:function(t){return t=t||Warden.configure.cmp,process.call(this,function(n,e){var r=e.host().data,i=r.fires,s=r.takes,a=(i.length>1||s.length>0)&&(t(n,i[i.length-2])||t(n,s.last()));return a?e.stop():e.next(n)})},pipe:function(t){return process.call(this,function(n,e){t(n,e.next.bind(e))})},debounce:function(t){return process.call(this,function(n,e){var r=e.host();clearTimeout(r.data.dbtimer),r.data.dbtimer=setTimeout(function(){delete r.data.dbtimer,e.play(),e.next(n)},t),e.pause()})},collect:function(t){return process.call(this,function(n,e){var r=e.host();r.data.fires.length-1;r.data.tmpCollection=r.data.tmpCollection||[],r.data.tmpCollection.push(n),r.data.timer?e.pause():(r.data.timer=setTimeout(function(){var t=r.data.tmpCollection;clearTimeout(r.data.timer),delete r.data.timer,delete r.data.tmpCollection,e.play(),e.next(t)},t),e.pause())})},filterFor:function(t){var n;return process.call(this,function(e,r){var i={get:function(t){return t?t(n):n},next:function(t,e){n=e?e(n,t):t,r.next(t)},stop:function(t){r.stop()}};return t(e,i)})},collectFor:function(t){var n=[];return this.listen(function(t){n.push(t)}),Warden.Stream(function(e){t.listen(function(){e(n),n=[]})})},delay:function(t){return process.call(this,function(n,e){setTimeout(function(){e.next(n)},t)})},toggle:function(t,n){var e=!1;return this.listen(function(r){e?n.call(this,r):t.call(this,r),e=!e})},after:function(t,n){var e=!1;return t.listen(function(){e=!0}),process.call(this,function(t,r){e?(e=n===!0?!1:!0,r.play(),r.next(t)):r.pause()})},repeat:function(t,n){var e=this,r=t;return inheritFrom(Warden.Stream(function(i){e.listen(function(e){var s=setInterval(function(){t?(i(e),t--):(t=r,clearInterval(s))},n)})}),this)},waitFor:function(t){var n=this;return Warden.Stream(function(e){var r,i=!1,s=function(){r=null,i=!1};t.listen(function(t){i&&(e(r),s())}),n.listen(function(t){r=t,i=!0})}).host()},merge:function(){var t=Warden.Stream(this.$$id,this.$$context),n=toArray(arguments);return n.push(this),each(n,function(n){n.listen(function(n){t.fire(n)})}),t},alternately:function(t){var n=this,e=0;return Warden.Stream(function(r){n.listen(function(t){0==e&&(r(t),e=1)}),t.listen(function(t){1==e&&(r(t),e=0)})})},resolve:function(t,n,e){var r=this;return Warden.Stream(function(i){r.sync(t).listen(function(t){i(n.call(e,t[0],t[1]))})},e||this.$$context)},combine:function(t,n,e){var r=this;return Warden.Stream(function(i){function s(t,e){i(n.call(r.$$context,t,e))}r.listen(function(n){s(n,t.data.last||e)}),t.listen(function(t){s(r.data.last||e,t)})},this.$$context)},sync:function(){var t,n=toArray(arguments),e=[],r=[];return n.unshift(this),e.length=r.length=n.length,t=Warden.Stream(function(t){each(n,function(i,s){i.listen(function(i){var a=r.length?!0:!1;Utils.forWhile(r,function(t,n){return n==s?!0:(t||(a=!1),t)},!1),e[s]=i,a?(t(e),e=[],r=[],e.length=r.length=n.length):r[s]=!0})})})},stream:function(){return inheritFrom(new Stream,this)},swap:function(t){function n(t,n){t.locked=!n,each(t.children,function(t){t.swap(n)})}n(this,t)},toggleOn:function(t,n){var e=this;t instanceof Stream&&t.listen(function(){e.swap(n)})},lock:function(t){return this.swap(!1),t&&this.toggleOn(t,!1),this},lockThis:function(){return this.locked=!0,this},unlockThis:function(){return this.locked=!1,this},unlock:function(t){return this.swap(!0),t&&this.toggleOn(t,!0),this}},Object.defineProperty(Stream.prototype,"value",{configurable:!0,get:function(){return this.data.last},set:function(t){this.fire(t)}}),Warden.configure.addToStream=function(t,n,e){Stream.prototype[t]=function(){arguments;return e?n.apply(this,arguments):process.call(this,n.apply(this,arguments))}},Warden.configure.isStream=function(t){return t instanceof Stream},Stream}();Warden.Stream=function(t,n,e){var r,i,s,a=[];if(n=n||{},r=new Stream([],n),is.fn(t)){if(e===!0){i=t.toString();for(s in n)n.hasOwnProperty(s)&&a.push(s);a.length&&each(a,function(t){i.indexOf("this."+t)>=0&&console.error("Coincidence: property: '"+t+"' is already defined in stream context!",n)})}t.call(n,function(t,n){r.fire(t,n)})}return r},Warden.Watcher=function(){var argv=Utils.toArray(arguments).slice(1,arguments.length),argc=argv.length,bus=arguments[0],a=argv[0],b=argv[1],fn,st;if(1===argc)is.str(a)?fn=function(t){this[a]=t}:is.fn(a)&&(fn=function(t){a(t)});else if(is.obj(a)&&is.str(b))if(b.indexOf("/")>=0){var dest="";each(b.split("/"),function(name){if(!is.exist(eval("a"+dest)[name]))throw"Unknown property: "+name+" from chain: "+b;dest+='["'+name+'"]'}),fn=function binding(event){eval("a"+dest+"= event")}}else fn=is.fn(a[b])?function(t){a[b](t)}:fn=function(t){a[b]=t};else is.fn(b)&&(fn=function(t){b.call(a,t)});return st=fn,bus.listen(fn),{update:fn,remove:function(){bus.mute("binding")}}},Warden.Formula=function(t,n,e){var r=Warden.Stream(n.toString(),e||{});return each(t,function(i){i.listen(function(i){var s=n.apply(e||this,t);r.fire(s)})}),r.watch(),r.value=n.apply(e,t),r}}(),jQueryInited&&Warden(jQuery),Warden});
//# sourceMappingURL=warden.min.js.map
